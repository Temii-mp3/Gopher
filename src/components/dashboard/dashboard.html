<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
</head>

<body>
  <div class="mainContainer">
    <div class="header">
      <h1>Gopher</h1>
    </div>
    <div class="chart_goalsContainer">
      <div class="goalOptions">
        <button (click)="addGoal()">New Goal</button>
        <button (click)="toggleView()" [class.isFocused]="viewMode">View Goals</button>
        <button (click)="toggleEdit()" [class.isFocused]="editMode">Edit Goals</button>
      </div>
      <mat-card class="chart_goalsCard" appearance="outlined">
        <div class="goalContainer">
          @if(viewMode) {
          <div class="chart">
            <canvas baseChart width="800" height="400" [type]="'line'" [data]="lineChartData"
              [options]="lineChartOptions" [legend]="lineChartLegend">
            </canvas>
          </div>
          <div>
            <div class="sprintStatus">
              @if(getCurrSprint(); as sprint){
              @if(sprint.status == 'planning'){
              <div>
                <p>Current Sprint Status: Planning</p>
                <p>Planned Duration: {{(sprint.duration/7)}} weeks</p>
              </div>
              <div class="planningOptions">
                <button (click)="editSprint(sprint)">Edit Sprint</button>
                <button (click)="startSprint()">Start Sprint</button>
              </div>
              } @else if(sprint.status == 'active'){
              <p>Current Sprint Status: Active</p>
              <button (click)="endSprint()">End Sprint</button>
              }
              } @else {
              <p>No Active Sprint</p>
              <button (click)="createSprint()">New Sprint</button>
              }
            </div>
            <mat-card class="goalCard" appearance="outlined">
              <mat-card-header>
                <mat-card-title>Your Goals</mat-card-title>
                <mat-card-subtitle>Goals for: {{ currDate }} </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content class="child_container">
                @for (item of paginatedGoals; track item.id) {
                <mat-card class="goal">
                  @if(item.completed) {
                  <div>
                    <mat-card-title>
                      <s>{{ item.name }}</s></mat-card-title>
                    <mat-card-subtitle>
                      <s>{{ item.target }}</s></mat-card-subtitle>
                  </div>

                  <mat-checkbox [checked]="item.completed" (change)="toggleCompletion(item)">Completed</mat-checkbox>

                  } @else {
                  <div>
                    <mat-card-title>{{ item.name }}</mat-card-title>
                    <mat-card-subtitle> {{ item.target }}</mat-card-subtitle>
                  </div>

                  <mat-checkbox [checked]="item.completed" (change)="toggleCompletion(item)">Complete</mat-checkbox>

                  }
                </mat-card>
                }
                <mat-paginator [length]="totalGoals" [pageSize]="pageSize" [pageIndex]="pageIndex"
                  [pageSizeOptions]="pageSizeOptions" (page)="onPageChange($event)" aria-label="Select page">
                </mat-paginator>
              </mat-card-content>
            </mat-card>
          </div>
          } @else{
          <mat-card class="goalCard" appearance="outlined">
            <mat-card-header>
              <mat-card-title>Your Goals</mat-card-title>
              <mat-card-subtitle>Edit Goals</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content class="child_container">
              @for (goal of paginatedGoals; track goal.id) {
              <mat-card class="edit_container">
                <mat-card-header>
                  <mat-card-title>{{ goal.name }}</mat-card-title>
                  <mat-card-subtitle>{{ goal.target }}</mat-card-subtitle>
                </mat-card-header>
                <button matIconButton [matMenuTriggerFor]="menu" #menuTrigger>
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="editGoal(goal)">Edit</button>
                  <button mat-menu-item (click)="deleteGoal(goal)">Delete</button>
                </mat-menu>
              </mat-card>
              }
              <mat-paginator [length]="totalGoals" [pageSize]="pageSize" [pageIndex]="pageIndex"
                [pageSizeOptions]="pageSizeOptions" (page)="onPageChange($event)" aria-label="Select page">
              </mat-paginator>
            </mat-card-content>
          </mat-card>
          }
        </div>
      </mat-card>
    </div>
  </div>
</body>

</html>